## WebRays C++ API Reference

WebRays is primarily developed as a C++ library that exposes a low-level C API and gets compiled to WebAssembly for use on the Web. We also strive to maintain a stable C API so that WebRays can be easily used for both **web** and **native** development.

|      Function          | Description     |
|:--|:--|
| `wr_handle` wrays_init (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_backend_type` backend_type,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` data<br />)  | Create a webrays instance with the requested `backend_type` |
| `wr_error` wrays_update (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_update_flags*` flags<br />) | Perform any pending updates. This function should be called after any important interaction with the WebRays API in order to submit changes. For example every time a shape is added or  an instance is updated. The returned `flags` should be used by the user to determine if further updates should take place on the application side as well. |
| `wr_error` wrays_create_ads (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle*` ads,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_ads_descriptor*` options,<br />&nbsp;&nbsp;&nbsp;&nbsp;`int` options_count<br />) | `options` are an array `options_count` key-value pairs that control certain properties of the requested ADS. Currently the only available option is to select if the created ADS will be a `BLAS` or a `TLAS` |
| `wr_error` wrays_add_shape (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` ads,<br />&nbsp;&nbsp;&nbsp;&nbsp;`float*` positions,<br />&nbsp;&nbsp;&nbsp;&nbsp;`int` position_stride,<br />&nbsp;&nbsp;&nbsp;&nbsp;`float*` normals,<br />&nbsp;&nbsp;&nbsp;&nbsp;`int` normal_stride,<br />&nbsp;&nbsp;&nbsp;&nbsp;`float*` uvs,<br />&nbsp;&nbsp;&nbsp;&nbsp;`int` uv_stride,<br />&nbsp;&nbsp;&nbsp;&nbsp;`int` num_vertices,<br />&nbsp;&nbsp;&nbsp;&nbsp;`int*` indices,<br />&nbsp;&nbsp;&nbsp;&nbsp;`int` num_triangles,<br />&nbsp;&nbsp;&nbsp;&nbsp;`int*` shape_id<br />) | Vertices and Normals are defined by 3 consecutive `float`s (X, Y, Z) in their respective arrays. UVs are similarly defined by 2 `float`s (U, V). Faces are defined by 4 consecutive `int`s (X, Y, Z, W). The first 3 are the indices for each attribute. The W component is left under user control amd cam be used to store per-face information. The returned shape id represents the geometry group <br /> defined by the provided arrays |
| `wr_error` wrays_add_instance (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` tlas,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` blas,<br />&nbsp;&nbsp;&nbsp;&nbsp;`float*` transformation,<br />&nbsp;&nbsp;&nbsp;&nbsp;`int*` instance_id<br />) | The `transformation` matrix is expected in column-major order with the translation part being at positions 9, 10, and 11 |
| `wr_error` wrays_update_instance (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` tlas,<br />&nbsp;&nbsp;&nbsp;&nbsp;`int` instance_id,<br />&nbsp;&nbsp;&nbsp;&nbsp;`float*` transformation<br />) | The `instance_id` is returned ny a previous call to `wrays_add_instance`. The transformation matrix is expected in **column-major** order with the translation part being at positions 9, 10, and 11 |
| `wr_error` wrays_query_intersection (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` ads,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle*` ray_buffers,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size` ray_buffer_count,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` intersections,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size*` dimensions,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size` dimension_count<br />) | Take the ray origins and directions from the provided `ray_buffers`, intersect them with the `ads` and store the **closest-hit** results in `intersections`. |
| `wr_error` wrays_query_occlusion (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` ads,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle*` ray_buffers,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size` ray_buffer_count,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` occlusion,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size*` dimensions,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size` dimension_count<br />) | Take the ray origins and directions from the provided `ray_buffers`, intersect them with the `ads` and store the binary **occlusion** results in `occlusion` |
| `wr_error` wrays_ray_buffer_requirements (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_buffer_info*` buffer_info,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size*` dimensions,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size` dimensions_count<br />) | Request the requirements for a ray buffer of dimensionality `dimensions_count` and size `dimensions`. The `buffer_info` struct will be filled with the appropriate information. For example a 2D ray buffer will naturally be backed by a 2D RGBA32F texture. The actual allocation of the buffers is left to the application for finer control. The WebGL backend currently only supports 2D ray buffers. |
| `wr_error` wrays_intersection_buffer_requirements (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_buffer_info*` buffer_info,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size*` dimensions,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size` dimensions_count<br />) | Request the requirements for an intersection buffer of dimensionality `dimensions_count` and size `dimensions` that will receive **closest-hit** results. The `buffer_info` struct will be filled with the appropriate information. For example a 2D intersection buffer will naturally be backed by a 2D RGBA32I texture. The actual allocation of the buffers is left to the application for finer control. The WebGL backend currently only supports 2D intersection buffers. |
| `wr_error` wrays_occlusion_buffer_requirements (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_buffer_info*` buffer_info,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size*` dimensions,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_size` dimensions_count<br />) | Request the requirements for an occlusion buffer of dimensionality `dimensions_count` and size `dimensions` that will receive **occlusion** results. The `buffer_info` struct will be filled with the appropriate information. For example a 2D occlusion buffer will naturally be backed by a 2D R32I texture. The actual allocation of the buffers is left to the application for finer control. The WebGL backend currently only supports 2D occlusion buffers. |
| `const char *` wrays_get_scene_accessor (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance<br />) | Returns a string representation of the accessor code. For example, in the WebGL implementation, this includes the GLSL API that can be used for in-shader intersections. `wrays_update` indicates when this code has changed and users should make sure to always use the latest in-shader API in their shaders. In WebGL this API simply needs to get prepended to the user's code. |
| `const wr_binding *` wrays_get_scene_accessor_bindings (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance<br />) | Get the bindings for the data structures. For example, in the WebGL implementation, these include the textures, buffers e.t.c. that are required for the GLSL API to function within a user's shader. `wrays_update` indicates when these bindings have changed and users should make sure to use the latest bindings in their applciation |
| `const char *` wrays_error_string (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_error` error<br />) | Returns a human-friendly error message for the provided error. |
| `wr_error` wrays_destroy (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance<br />)  | Destroy a previously created webrays instance |
| `wr_error` wrays_ads_destroy (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` ads<br />)  | Destroy a previously created ads. |
| `wr_error` wrays_ray_buffer_destroy (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` buffer<br />)  | Destroy a previously created ray buffer. Since WebRays gives complete memory control to the user regarding buffers, this routines does nothing in most cases |
| `wr_error` wrays_intersection_buffer_destroy (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` buffer<br />)  | Destroy a previously created intersection buffer. Since WebRays gives complete memory control to the user regarding buffers, this routines does nothing in most cases |
| `wr_error` wrays_occlusion_buffer_destroy (<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` instance,<br />&nbsp;&nbsp;&nbsp;&nbsp;`wr_handle` buffer<br />)  | Destroy a previously created occlusion buffer. Since WebRays gives complete memory control to the user regarding buffers, this routines does nothing in most cases |
